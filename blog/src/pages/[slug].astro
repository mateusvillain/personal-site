---
import { getCollection } from 'astro:content'
import BlogLayout from '../layouts/BlogLayout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('blog')

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }))
}

const { post } = Astro.props

// ⬇️ AQUI está a parte importante
const { Content } = await post.render()

// Formata a data no formato "DD Mês YYYY"
const date = new Date(post.data.date)
const months = [
  'Jan',
  'Fev',
  'Mar',
  'Abr',
  'Mai',
  'Jun',
  'Jul',
  'Ago',
  'Set',
  'Out',
  'Nov',
  'Dez',
]
const formattedDate = `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`

// Tempo de leitura (média de 200 palavras por minuto)
const wordCount = post.body.trim().split(/\s+/).length
const readingTime = Math.max(1, Math.ceil(wordCount / 200))
---

<BlogLayout
  title={post.data.title}
  description={post.data.description}
  cover={post.data.cover}
>
  <div class="home-link">
    <p class="body--md">
      <a
        href="../../../index.html"
        class="link"
        aria-label="Ir para a página inicial">Início</a
      >
    </p>
    <p class="body--md">
      <a href="../../blog" class="link" aria-label="Ir para o blog">Blog</a>
    </p>
  </div>
  <article class="full-post">
    <section class="post-details">
      <h1 class="title">{post.data.title}</h1>
      <div class="flex">
        <time class="body--md" datetime={post.data.date}>{formattedDate}</time>
        <p class="read-time body--md">
          {readingTime} <span aria-label="minutos">min</span> de leitura
        </p>
      </div>
    </section>

    <Content />
  </article>
</BlogLayout>
