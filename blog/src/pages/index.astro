---
import { getCollection } from 'astro:content'
import BlogLayout from '../layouts/Blog.astro'

const posts = (await getCollection('blog')).sort(
  (a, b) => new Date(b.data.date) - new Date(a.data.date),
)

type PostList = typeof posts
const postsByYear: Record<number, PostList> = {}
for (const post of posts) {
  const year = new Date(post.data.date).getFullYear()
  if (!postsByYear[year]) postsByYear[year] = []
  postsByYear[year].push(post)
}

const years = Object.keys(postsByYear)
  .map(Number)
  .sort((a, b) => b - a)

const months = [
  'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
  'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez',
]
---

<BlogLayout
  title="Blog - Mateus Villain"
  description="Blog sobre tecnologia, design system, UI e UX. Conteúdos práticos, tendências, boas práticas e reflexões para criar produtos digitais mais consistentes, escaláveis e centrados no usuário."
>
  <div class="home-link">
    <p class="body--md">
      <a
        href="../../../index.html"
        class="link body--md"
        aria-label="Ir para a página inicial">Início</a
      >
    </p>
  </div>
  <div class="post-details">
    <h1 class="title">Blog</h1>
  </div>
  {
    years.map((year) => (
      <section class="posts-year-group">
        <h2 class="body--lg posts-year-label">{year}</h2>
        {postsByYear[year].map((post) => {
          const date = new Date(post.data.date)
          const formattedDate = `${String(date.getDate()).padStart(2, '0')} ${months[date.getMonth()]}`
          return (
            <article class="post interaction-item">
              <a href={`/blog/${post.slug}`}>
                <div class="post-header">
                  <h3 class="body--lg">{post.data.title}</h3>
                  <p class="body--lg">{post.data.description}</p>
                </div>
                <time class="body--lg">{formattedDate}</time>
              </a>
            </article>
          )
        })}
      </section>
    ))
  }
</BlogLayout>
